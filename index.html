<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Signal War v6</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:monospace;background:#000;color:#0f0;overflow:hidden;font-size:12px}
#game{display:flex;height:100vh}
#canvas{flex:1;cursor:grab}
#canvas:active{cursor:grabbing}
#ui{width:350px;background:#0a0a0a;border-left:2px solid #0f0;padding:10px;overflow-y:auto}
h1{color:#0f0;font-size:14px;margin-bottom:10px}
.section{background:#111;padding:8px;margin-bottom:8px;border:1px solid #222}
.row{display:flex;justify-content:space-between;padding:4px;font-size:11px}
button{padding:5px 10px;background:#0f0;color:#000;border:none;cursor:pointer;margin:2px;font-family:monospace}
button:hover{background:#0a0}
button:disabled{background:#333;color:#666}
button.active{background:#f00;color:#fff}
.log{height:100px;overflow-y:auto;background:#000;padding:5px;font-size:10px;border:1px solid #222}
.stat{color:#888}
.val{color:#0f0}
.alert{color:#f00}
</style>
</head>
<body>
<div id="game">
<canvas id="canvas"></canvas>
<div id="ui">
<h1>ðŸ“¡ SIGNAL WAR v6</h1>
<div class="section">
<div class="row"><span class="stat">âš¡ ENERGY</span><span class="val" id="e">0</span></div>
<div class="row"><span class="stat">ðŸ”© MATTER</span><span class="val" id="m">0</span></div>
<div class="row"><span class="stat">ðŸ“¡ INFO</span><span class="val" id="i">0</span></div>
</div>
<div class="section">
<div class="row"><span class="stat">SIGNAL LAYER</span><span class="val" id="layer">OFF</span></div>
<button onclick="game.toggleLayer()">TOGGLE SIGNAL VIEW</button>
</div>
<div class="section">
<button id="btn-select" onclick="game.setMode('select')">SELECT</button>
<button id="btn-build" onclick="game.setMode('build')">BUILD GEN</button>
<button id="btn-destroy" onclick="game.setMode('destroy')">DESTROY</button>
<button id="btn-forge" onclick="game.setMode('forge')">FORGE SIGNAL</button>
<button id="btn-scout" onclick="game.setMode('scout')">SCOUT</button>
</div>
<div class="section">
<div id="info">Click to select</div>
</div>
<div class="section">
<button onclick="game.speed=game.speed==1?10:1">SPEED x10</button>
<button onclick="game.save()">SAVE</button>
<button onclick="game.load()">LOAD</button>
<button onclick="game.reset()">RESET</button>
</div>
<div class="log" id="log"></div>
</div>
</div>
<script>
const CONFIG={MAP_W:80,MAP_H:80,HEX_SIZE:12,TICK:200,START_E:500,START_M:300,START_I:50,SIGNAL_DECAY:0.9};
class Game{constructor(){this.c=document.getElementById('canvas');this.x=this.c.getContext('2d');this.cam={x:0,y:0,z:1};this.tick=0;this.speed=1;this.showSignal=false;this.mode='select';this.res={E:CONFIG.START_E,M:CONFIG.START_M,I:CONFIG.START_I};this.grid=[];this.signals=[];this.entities=[];this.selected=null;this.init();this.setup();this.start()}
init(){for(let q=0;q<CONFIG.MAP_W;q++){for(let r=0;r<CONFIG.MAP_H;r++){let h=Math.floor((Math.sin(q*0.1)*Math.cos(r*0.1)+1)*30);this.grid.push({q,r,x:0,y:0,h,m:h*10,e:null});this.signals.push({s:0,f:false,a:0})}}let cx=Math.floor(CONFIG.MAP_W/2),cy=Math.floor(CONFIG.MAP_H/2);this.createEntity(cx,cy,'gen');this.createEntity(cx+1,cy,'storage');this.calcPos()}
calcPos(){let h=Math.sqrt(3)*CONFIG.HEX_SIZE;for(let c of this.grid){c.x=CONFIG.HEX_SIZE*1.5*c.q;c.y=h*(c.r+c.q*0.5)}}
setup(){let rs=()=>{this.c.width=this.c.parentElement.clientWidth;this.c.height=this.c.parentElement.clientHeight};window.addEventListener('resize',rs);rs();let d=false,l={x:0,y:0};this.c.addEventListener('mousedown',e=>{d=true;l={x:e.clientX,y:e.clientY}});this.c.addEventListener('mousemove',e=>{if(d){this.cam.x+=e.clientX-l.x;this.cam.y+=e.clientY-l.y;l={x:e.clientX,y:e.clientY}}});this.c.addEventListener('mouseup',()=>d=false);this.c.addEventListener('wheel',e=>{e.preventDefault();this.cam.z*=e.deltaY>0?0.9:1.1;this.cam.z=Math.max(0.3,Math.min(5,this.cam.z))});this.c.addEventListener('click',e=>this.onClick(e))}
get(q,r){if(q<0||q>=CONFIG.MAP_W||r<0||r>=CONFIG.MAP_H)return null;return this.grid[r*CONFIG.MAP_W+q]}
getSig(q,r){if(q<0||q>=CONFIG.MAP_W||r<0||r>=CONFIG.MAP_H)return null;return this.signals[r*CONFIG.MAP_W+q]}
toScreen(q,r){let h=Math.sqrt(3)*CONFIG.HEX_SIZE;return{x:(CONFIG.HEX_SIZE*1.5*q)*this.cam.z+this.cam.x+this.c.width/2,y:(h*(r+q*0.5))*this.cam.z+this.cam.y+this.c.height/2}}
toHex(sx,sy){let x=(sx-this.cam.x-this.c.width/2)/this.cam.z;let y=(sy-this.cam.y-this.c.height/2)/this.cam.z;let h=Math.sqrt(3)*CONFIG.HEX_SIZE;return{q:Math.round((2/3)*x/CONFIG.HEX_SIZE),r:Math.round((-1/3)*x/CONFIG.HEX_SIZE+y/h)}}
createEntity(q,r,type){let c=this.get(q,r);if(!c||c.e)return;let e={id:Date.now(),type,q,r,hp:100,owner:'player',storage:{E:0,M:0,I:0}};if(type=='gen'){e.prod={E:5};e.sig=8;e.cost={M:100,E:50}}else if(type=='storage'){e.cap=1000;e.sig=2;e.cost={M:200}}else if(type=='scout'){e.move=3;e.sig=1;e.vision=8;e.cost={M:30,E:20,I:20}}c.e=e;this.entities.push(e);this.emitSig(q,r,e.sig||5);return e}
emitSig(q,r,str,fake=false){let range=Math.ceil(str/2);for(let dq=-range;dq<=range;dq++){for(let dr=-range;dr<=range;dr++){let dist=(Math.abs(dq)+Math.abs(dr)+Math.abs(dq+dr))/2;if(dist>range)continue;let s=this.getSig(q+dq,r+dr);if(s){let local=str*Math.pow(CONFIG.SIGNAL_DECAY,dist);if(local>s.s){s.s=local;s.f=fake;s.a=0}}}}}
setMode(m){this.mode=m;document.querySelectorAll('button').forEach(b=>b.classList.remove('active'));document.getElementById('btn-'+m)?.classList.add('active')}
toggleLayer(){this.showSignal=!this.showSignal;document.getElementById('layer').textContent=this.showSignal?'ON':'OFF'}
onClick(e){let r=this.c.getBoundingClientRect();let p=this.toHex(e.clientX-r.left,e.clientY-r.top);let c=this.get(p.q,p.r);if(!c)return;switch(this.mode){case'select':this.selected=c.e;this.updateInfo(c);break;case'build':if(!c.e&&this.res.M>=100&&this.res.E>=50){this.res.M-=100;this.res.E-=50;this.createEntity(p.q,p.r,'gen');this.log('Generator built')}break;case'destroy':if(c.e){this.destroy(c.e)}else if(c.m>0){let ex=Math.min(50,c.m);c.m-=ex;c.h=Math.floor(c.m/10);this.res.M+=ex;this.emitSig(p.q,p.r,3);this.log('Extracted '+ex+'M')}break;case'forge':if(this.res.I>=20){this.res.I-=20;this.emitSig(p.q,p.r,15,true);this.log('FAKE SIGNAL at ('+p.q+','+p.r+')','alert')}break;case'scout':if(this.res.M>=30&&this.res.E>=20&&this.res.I>=20){this.res.M-=30;this.res.E-=20;this.res.I-=20;this.createEntity(p.q,p.r,'scout');this.log('Scout deployed')}break}}
destroy(e){let c=this.get(e.q,e.r);if(c)c.e=null;this.entities=this.entities.filter(x=>x!==e);if(e.cost){this.res.M+=Math.floor((e.cost.M||0)*0.5);this.res.E+=Math.floor((e.cost.E||0)*0.3)}this.emitSig(e.q,e.r,30);this.log(e.type+' destroyed')}
update(){this.tick++;for(let e of this.entities){if(e.prod){if(e.prod.E&&this.res.E<5000)this.res.E+=e.prod.E;if(e.prod.M)this.res.M+=e.prod.M;if(e.prod.I)this.res.I+=e.prod.I;this.emitSig(e.q,e.r,e.sig||5)}}for(let s of this.signals){s.s*=CONFIG.SIGNAL_DECAY;s.a++;if(s.s<0.1)s.s=0}document.getElementById('e').textContent=Math.floor(this.res.E);document.getElementById('m').textContent=Math.floor(this.res.M);document.getElementById('i').textContent=Math.floor(this.res.I)}
draw(){this.x.fillStyle='#000';this.x.fillRect(0,0,this.c.width,this.c.height);for(let c of this.grid){let p=this.toScreen(c.q,c.r);let s=CONFIG.HEX_SIZE*this.cam.z;if(p.x<-s||p.x>this.c.width+s||p.y<-s||p.y>this.c.height+s)continue;let sig=this.getSig(c.q,c.r);if(this.showSignal&&sig.s>1){let intensity=Math.min(1,sig.s/20);this.x.fillStyle=`rgba(${sig.f?255:255},${sig.f?100:0},0,${intensity*0.5})`;this.x.beginPath();this.x.arc(p.x,p.y,s*1.5,0,Math.PI*2);this.x.fill()}this.x.beginPath();for(let i=0;i<6;i++){let a=(Math.PI/3)*i;let x=p.x+s*Math.cos(a);let y=p.y+s*Math.sin(a);if(i==0)this.x.moveTo(x,y);else this.x.lineTo(x,y)}this.x.closePath();let h=c.h;this.x.fillStyle=`rgb(${20+h},${30+h/2},${20+h/3})`;this.x.fill();if(c.e){let colors={gen:'#0f0',storage:'#00f',scout:'#ff0'};this.x.fillStyle=colors[c.e.type]||'#fff';this.x.beginPath();this.x.arc(p.x,p.y,s*0.6,0,Math.PI*2);this.x.fill()}this.x.strokeStyle='#222';this.x.lineWidth=0.5;this.x.stroke()}requestAnimationFrame(()=>this.draw())}
updateInfo(c){let h='Position: ('+c.q+','+c.r+')<br>Height: '+c.h+'<br>Matter: '+c.m;let s=this.getSig(c.q,c.r);h+='<br>Signal: '+(s.s>1?s.s.toFixed(1)+(s.f?' [FAKE]':''):'none');if(c.e)h+='<br>Entity: '+c.e.type+'<br>HP: '+c.e.hp;document.getElementById('info').innerHTML=h}
log(m,c=''){let l=document.getElementById('log');let e=document.createElement('div');e.textContent='['+this.tick+'] '+m;e.className=c;l.insertBefore(e,l.firstChild);if(l.children.length>20)l.lastChild.remove()}
save(){localStorage.setItem('sw6',JSON.stringify({tick:this.tick,res:this.res,entities:this.entities.map(e=>({type:e.type,q:e.q,r:e.r}))}));this.log('SAVED')}
load(){let d=localStorage.getItem('sw6');if(!d)return;let data=JSON.parse(d);this.tick=data.tick||0;this.res=data.res||{E:500,M:300,I:50};this.entities=[];for(let c of this.grid)c.e=null;for(let e of data.entities||[]){this.createEntity(e.q,e.r,e.type)}this.log('LOADED')}
reset(){if(confirm('RESET?')){this.init();this.log('RESET')}}
start(){setInterval(()=>{for(let i=0;i<this.speed;i++)this.update()},CONFIG.TICK);this.draw()}}
let game=new Game();
</script>
</body>
</html>
